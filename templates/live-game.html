<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Game - {{ riot_id }} | LoL Stats</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .live-game-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }

        .game-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .prediction-section {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .prediction-bars {
            display: flex;
            margin: 15px 0;
            border-radius: 5px;
            overflow: hidden;
            height: 40px;
        }

        .team1-bar {
            background: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .team2-bar {
            background: #e74c3c;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .teams-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .team {
            flex: 1;
            background: #34495e;
            border-radius: 10px;
            overflow: hidden;
        }

        .team-header {
            padding: 15px;
            text-align: center;
            font-weight: bold;
            color: white;
        }

        .team1-header {
            background: #3498db;
        }

        .team2-header {
            background: #e74c3c;
        }

        .player-row {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #2c3e50;
            color: white;
        }

        .player-row:last-child {
            border-bottom: none;
        }

        .champion-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #555;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .champion-name {
            font-size: 14px;
            color: #bdc3c7;
        }

        .rank-info {
            text-align: right;
            font-size: 12px;
        }

        .rank-tier {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .rank-stats {
            color: #bdc3c7;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .not-in-game {
            background: #95a5a6;
            color: white;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
        }

        .refresh-button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }

        .refresh-button:hover {
            background: #229954;
        }

        .tier-IRON { color: #CD7F32; }
        .tier-BRONZE { color: #CD7F32; }
        .tier-SILVER { color: #C0C0C0; }
        .tier-GOLD { color: #FFD700; }
        .tier-PLATINUM { color: #00CED1; }
        .tier-EMERALD { color: #50C878; }
        .tier-DIAMOND { color: #B9F2FF; }
        .tier-MASTER { color: #C89B3C; }
        .tier-GRANDMASTER { color: #FF6B6B; }
        .tier-CHALLENGER { color: #F4C430; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-shield-alt"></i>
                <span>LoL Stats</span>
            </div>
            <ul class="nav-menu">
                <li><a href="/" class="nav-link">Home</a></li>
                <li><a href="/champions" class="nav-link">Champions</a></li>
                <li><a href="/leaderboard" class="nav-link">Ranking</a></li>
            </ul>
        </div>
    </nav>

    <div class="live-game-container">
        <div class="game-header">
            <h1><i class="fas fa-play-circle"></i> Live Game</h1>
            <p>Śledzenie meczu na żywo dla: <strong id="playerName">{{ riot_id }}</strong></p>
            <button class="refresh-button" onclick="loadLiveGame()">
                <i class="fas fa-sync-alt"></i> Odśwież
            </button>
        </div>

        <div id="loadingSection" class="loading">
            <i class="fas fa-spinner fa-spin fa-3x"></i>
            <p>Sprawdzanie czy gracz jest w grze...</p>
        </div>

        <div id="notInGameSection" class="not-in-game" style="display: none;">
            <i class="fas fa-moon fa-3x"></i>
            <h2>Gracz nie jest w grze</h2>
            <p>Ten gracz obecnie nie rozgrywa meczu.</p>
            <button class="refresh-button" onclick="loadLiveGame()">
                <i class="fas fa-sync-alt"></i> Sprawdź ponownie
            </button>
        </div>

        <div id="gameSection" style="display: none;">
            <div class="prediction-section">
                <h3><i class="fas fa-crystal-ball"></i> Przewidywanie AI</h3>
                <div class="prediction-bars" id="predictionBars">
                    <div class="team1-bar" id="team1Bar">Niebieska 50%</div>
                    <div class="team2-bar" id="team2Bar">Czerwona 50%</div>
                </div>
                <div id="predictionReasoning">
                    <p><strong>Analiza AI:</strong> <span id="reasoningText">Ładowanie przewidywania...</span></p>
                </div>
            </div>

            <div class="teams-container">
                <div class="team">
                    <div class="team-header team1-header">
                        <i class="fas fa-shield-alt"></i> Drużyna Niebieska
                    </div>
                    <div id="team1Players"></div>
                </div>

                <div class="team">
                    <div class="team-header team2-header">
                        <i class="fas fa-shield-alt"></i> Drużyna Czerwona
                    </div>
                    <div id="team2Players"></div>
                </div>
            </div>

            <div class="game-info">
                <div>
                    <strong>Czas trwania gry:</strong> <span id="gameLength">0:00</span>
                </div>
                <div>
                    <strong>Tryb gry:</strong> <span id="gameMode">Unknown</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const riotId = "{{ riot_id }}";
        let gameData = null;

        function formatGameTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function getRankColor(tier) {
            const colors = {
                'IRON': '#CD7F32',
                'BRONZE': '#CD7F32',
                'SILVER': '#C0C0C0',
                'GOLD': '#FFD700',
                'PLATINUM': '#00CED1',
                'EMERALD': '#50C878',
                'DIAMOND': '#B9F2FF',
                'MASTER': '#C89B3C',
                'GRANDMASTER': '#FF6B6B',
                'CHALLENGER': '#F4C430'
            };
            return colors[tier] || '#95a5a6';
        }

        function renderTeam(players, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            players.forEach(player => {
                const rank = player.rank;
                const winRate = rank.wins + rank.losses > 0 ? 
                    Math.round((rank.wins / (rank.wins + rank.losses)) * 100) : 0;
                
                const playerRow = document.createElement('div');
                playerRow.className = 'player-row';
                
                playerRow.innerHTML = `
                    <div class="champion-icon" style="background-color: ${getRankColor(rank.tier)}20; border: 2px solid ${getRankColor(rank.tier)};">
                        ${player.championName.substring(0, 2)}
                    </div>
                    <div class="player-info">
                        <div class="player-name">${player.summonerName}</div>
                        <div class="champion-name">${player.championName}</div>
                    </div>
                    <div class="rank-info">
                        <div class="rank-tier" style="color: ${getRankColor(rank.tier)};">
                            ${rank.tier} ${rank.rank}
                        </div>
                        <div class="rank-stats">
                            ${rank.leaguePoints} LP
                        </div>
                        <div class="rank-stats">
                            ${rank.wins}W ${rank.losses}L (${winRate}%)
                        </div>
                    </div>
                `;
                
                container.appendChild(playerRow);
            });
        }

        function updatePrediction(prediction) {
            const team1Chance = prediction.team1_win_chance || 50;
            const team2Chance = prediction.team2_win_chance || 50;
            
            const team1Bar = document.getElementById('team1Bar');
            const team2Bar = document.getElementById('team2Bar');
            const reasoningText = document.getElementById('reasoningText');
            
            team1Bar.style.flex = team1Chance;
            team2Bar.style.flex = team2Chance;
            
            team1Bar.textContent = `Niebieska ${team1Chance}%`;
            team2Bar.textContent = `Czerwona ${team2Chance}%`;
            
            reasoningText.textContent = prediction.reasoning || 'Brak analizy dostępnej';
        }

        function loadLiveGame() {
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('notInGameSection').style.display = 'none';
            document.getElementById('gameSection').style.display = 'none';
            
            fetch(`/api/live-game/${encodeURIComponent(riotId)}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('loadingSection').style.display = 'none';
                    
                    if (!data.inGame) {
                        document.getElementById('notInGameSection').style.display = 'block';
                        return;
                    }
                    
                    gameData = data;
                    document.getElementById('gameSection').style.display = 'block';
                    
                    // Update game info
                    document.getElementById('gameLength').textContent = formatGameTime(data.gameLength);
                    document.getElementById('gameMode').textContent = data.gameMode || 'Unknown';
                    
                    // Render teams
                    renderTeam(data.team1, 'team1Players');
                    renderTeam(data.team2, 'team2Players');
                    
                    // Update prediction
                    if (data.prediction) {
                        updatePrediction(data.prediction);
                    }
                    
                    // Auto-refresh every 30 seconds
                    setTimeout(loadLiveGame, 30000);
                })
                .catch(error => {
                    console.error('Error loading live game:', error);
                    document.getElementById('loadingSection').style.display = 'none';
                    document.getElementById('notInGameSection').style.display = 'block';
                });
        }

        // Load live game data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadLiveGame();
        });
    </script>
</body>
</html>